
exports.up = async (knex) => {
  await knex.schema
    .createTable('clients', (tbl) => {
      tbl.increments('client_id')
      tbl.string('client_name', 64).notNullable()
      tbl.string('password').notNullable()
      tbl.string('role', 8).defaultTo('client')
      tbl.timestamps(false, true)
    })
    .createTable('instructors', tbl => {
        tbl.increments('instructor_id')
        tbl.string('instructor_name').notNullable()
        tbl.string('role', 12).defaultTo('instructor')
        tbl.string('password').notNullable()
    })
      .createTable('classes', tbl => {
          tbl.increments('class_id')
          tbl.string('class_name').notNullable()
          tbl.string('start_time').notNullable()
          tbl.string('class_type').notNullable()
          tbl.string('duration').notNullable()
          tbl.integer('intensity_level').notNullable()
          tbl.string('location').notNullable()
          tbl.integer('current_clients').defaultTo(0)
          tbl.integer('max_class_size').notNullable()
          tbl.integer('instructor_id')
              .unsigned()
              .notNullable()
              .references('instructor_id')
              .inTable('instructors')
              .onUpdate('CASCADE')
              .onDelete('CASCADE')
      })
      .createTable('client_reservations', tbl => {
          tbl.increments('cr_id')
          tbl.integer('class_id')
              .unsigned()
              .notNullable()
              .references('class_id')
              .inTable('classes')
              .onUpdate('CASCADE')
              .onDelete('CASCADE')
          tbl.integer('client_id')
              .unsigned()
              .notNullable()
              .references('client_id')
              .inTable('clients')
              .onUpdate('CASCADE')
              .onDelete('CASCADE')
      })
      .createTable('client_punch_card', tbl => {
          tbl.increments('pc_id')
          tbl.integer('cr_id')
              .unsigned()
              .notNullable()
              .references('cr_id')
              .inTable('client_reservations')
              .onUpdate('CASCADE')
              .onDelete('CASCADE')
          tbl.integer('client_id')
              .unsigned()
              .notNullable()
              .references('client_id')
              .inTable('clients')
              .onUpdate('CASCADE')
              .onDelete('CASCADE')
          tbl.integer('class_id')
              .unsigned()
              .notNullable()
              .references('class_id')
              .inTable('classes')
              .onUpdate('CASCADE')
              .onDelete('CASCADE')
          tbl.integer('current_class_num').defaultTo(0)
          tbl.integer('max_class_num').defaultTo(6)
      })
}

exports.down = async (knex) => {
  await knex.schema.dropTableIfExists('client_punch_card')
  await knex.schema.dropTableIfExists('client_reservations')
  await knex.schema.dropTableIfExists('classes')
  await knex.schema.dropTableIfExists('instructors')
  await knex.schema.dropTableIfExists('clients')
}
